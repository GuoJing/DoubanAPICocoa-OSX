
<!DOCTYPE HTML>
<html>
<head>
    <title>GuoJing/DoubanAPICocoa-OSX Project</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>
<link rel="stylesheet" href="/style/style.css" type="text/css">
<meta content="Douban api for cocoa, Very simple and easy to use. Support OS X Now." name="description"/>
<meta content="GuoJing/DoubanAPICocoa-OSX" name="keywords"/>
<script>
 $(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        },
        function(){
            $(this).animate({opacity: 1}, 400)
        });
 });
 function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
 }
</script>
<style>
    .content img {
        width: auto;
    }
</style>
</head>

<body>

<div class="container">
<div class="banner">
 <ul class="nav nav-pills">
  <li><a href="/">Blog</a></li>
  <li><a href="https://github.com/GuoJing/DoubanAPICocoa-OSX">Github</a></li>
 </ul>
</div>

<div class="main clearfix">


<div class="posts">
    <div class="title">DoubanAPICocoa-OSX</div>
<div class="content">
    <h2>概要</h2>

<p>DoubanAPICocoa是一个Cocoa封装的豆瓣API库，非官方版，可以使用于OS X，并支持10.6及之后的版本。<a href="https://github.com/GuoJing/DoubanAPICocoa-iOS">iOS 版本请参考这里</a>。</p>

<p>DoubanAPICocoa的底层支持并兼容老版本的<a href="https://github.com/lincode/douban-objc-client">douban-objc-client</a>，熟悉<a href="https://github.com/lincode/douban-objc-client">douban-objc-client</a>开发的同学也可以不用更新代码，直接移植到新的库里并且编译通过。但推荐使用DoubanAPICocoa提供的DOUEngine来实现代码。</p>

<p>注意：示例请自行替换apiKey，并且自行申请相关权限，如豆邮和线上活动以及更多高级的功能。</p>

<h3>目的</h3>

<ol>
<li>使开发更加容易，不用关注网络层的细节</li>
</ol>

<h3>特点</h3>

<ol>
<li>封装网络层</li>
<li>简单</li>
<li>使用闭包让开发者开发更简单</li>
<li>All consts</li>
<li>No Warning, No Error and No Build Analyze Errors</li>
</ol>

<h3>样例</h3>

<h4>验证</h4>

<p>声明一个engine：</p>

<pre><code>engine = [[DOUEngine alloc] initWithApiKey:kAPIKey withSecretKey:kPrivateKey withRedirUrl:kRedirectUrl];
</code></pre>

<p>打开豆瓣验证url：</p>

<pre><code>NSString *url_str = [self.engine getConnectUrl];
</code></pre>

<p>从豆瓣返回code并初始化engine：</p>

<pre><code>[self.engine didLoadWithCode:code];
</code></pre>

<p>验证通过。</p>

<h4>我是谁</h4>

<pre><code>[u getWhoAmI:successUserBlock failedBlock:failBlock];
</code></pre>

<h4>发广播</h4>

<pre><code>DOUBroadcastEngine *s = [self.engine getEngine:kDOUBroadcast];
[s say:self.shuo_field.title successBlock:successBlock failedBlock:failBlock];
</code></pre>

<h4>获取同城活动</h4>

<pre><code>DOUEventEngine *event_engine = [self.engine getEngine:kDOUEvent];
[event_engine getEventWithRemoteID:self.eid_field.title successBlock:successBlock failedBlock:failedBlock];
</code></pre>

<h3>变量</h3>

<p>该库封装了常用的变量，比如发日记如果是发私有的日记，可以直接使用kDOUPrivacyPrivate，同样相册的排序方式可以使用kDOUOrderDesc，无需自己写变量。</p>

<p>常用的变量文件在库的Engine/Utils里。</p>

<ol>
<li>DOUAPIConsts.h</li>
<li>DOUAPIConsts.h</li>
<li>DOUAPIErrorConsts.h</li>
</ol>

<h3>开发</h3>

<p>这个库支持最老的底层的实现方法，也可以非常容易的使用engine进行api开发，可以通过kDOU产品线获得相应的engine，每个engine都有getEngine方法。不过推荐在外面包装一个单例的共享engine，方便在代码各处使用。</p>

<p>可以删除任意不需要的模块并重新打包和分发，减少代码。</p>

<h3>示例</h3>

<p>大部分接口都有基本的示例，今后会提供更多更丰富的示例。</p>

<h2>其他</h2>

<p><strong><a href="http://developers.douban.com/">豆瓣API</a></strong></p>

<p><strong>并且该版本不支持GData等V1版本特性，只支持V2。</strong></p>

<p>如果你需要iOS版本，请去:</p>

<ol>
<li>开发版：<a href="https://github.com/lincode/douban-objc-client">douban-objc-client</a></li>
<li>官方版：<a href="https://github.com/douban/douban-objc-client">douban-objc-client</a></li>
</ol>

<h2>信息</h2>

<p>当前版本V0.1.3，主要职责为兼容iOS版本并且封装网络层，今后使用的方法可能会不同。</p>

<p>当前版本不支持GData等V1版本特性，只支持V2，所以必须使用https。</p>

<p>当前版本只适用于64位版本，考虑到今后32位的Mac也不多，所以暂时不打算支持。</p>

<h2>使用</h2>

<h3>使用Framework</h3>

<p>下载代码之后，可以看到Sample代码里有一个<code>DoubanAPICocoa.framework</code>，直接import到自己的包里即可。</p>

<p><code>Xcode</code> -&gt; <code>Add files to PROJECT</code> -&gt; <code>select the folder</code></p>

<p>你会看到一个小的工具箱，名字为DoubanAPICocoa库已经增加完毕。</p>

<p><img src="http://guojing.me/images/2012/samplecode.png" alt="samplecode"></p>

<p>在项目的<code>Build Phases</code>里的<code>Link Binary with Libraries</code>增加必要的组件，如<code>Security.framework</code>。</p>

<p>同样在<code>Build Phases</code>里，在右下角找到<code>Add Build Phase</code>，在下拉列表中选择<code>Add Build Phase</code>，一个新的框会出现在这个页面里，打开刚创建的框，里面把刚才添加在文件列表的framework拖动到此处。并在分类选项里选择Framework。</p>

<p><img src="http://guojing.me/images/2012/sampleconfig.png" alt="sampleconfig"></p>

<h3>直接引用Framework Project</h3>

<p>直接拖动DoubanAPICocoa包到项目中。</p>

<p>打开自己的项目，在项目信息中，选择<code>TARGET</code>并在里面设置编译选项，搜寻<code>Header Search Path</code>，设置DoubanAPICocoa的路径。</p>

<p>在项目的<code>Build Phases</code>里的<code>Link Binary with Libraries</code>增加必要的组件，如<code>Security.framework</code>。</p>

<p>同样在<code>Build Phases</code>里，在右下角找到<code>Add Build Phase</code>，在下拉列表中选择<code>Add Build Phase</code>，一个新的框会出现在这个页面里，打开刚创建的框，把你需要使用的拷贝的项目拖动到此处。</p>

<h3>编译</h3>

<p>无论是DoubanAPICocoa.framework还是Sample代码，在编译的时候都没有错误和警告，至少在我的平台下，如果在某些平台下出现问题，请通知我。</p>

<h3>错误调试</h3>

<p>如果引用进来出现错误，一般是<code>image not found</code>，说明DoubanAPICocoa包引用出错了，可能以下几种方法能帮到你。</p>

<ol>
<li>增加文件时候选择 <code>Copy items into destination group&#39;s folder</code></li>
<li>可能需要在项目的<code>Build Phases</code>里的<code>Link Binary with Libraries</code>增加必要的组件，如<code>Security.framework</code>。</li>
<li>Header Search Path设置出错。</li>
</ol>

<p><strong>TIPS：一般来说，找不到framework的主要原因在于路径设置出错。</strong></p>

<h3>可能需要的包</h3>

<ul>
<li>SystemConfiguration.framework</li>
<li>Security.framework</li>
<li>libxml2.dylib</li>
<li>libz.dylib</li>
<li>Foundation.framework</li>
</ul>

<h2>使用</h2>

<p>和iOS版本的使用方法类似。</p>

<h3>提供OAuth2的参数</h3>

<pre><code>  DOUService *service = [DOUService sharedInstance];
  service.clientId = kAPIKey;
  service.clientSecret = kPrivateKey;
</code></pre>

<h3>发起一个异步请求</h3>

<pre><code>NSString *subPath = [NSString stringWithFormat:@&quot;/v2/event/%d&quot;, event_id];

DOUQuery *query = [[[DOUQuery alloc] initWithSubPath:subPath parameters:nil] autorelease];

query.apiBaseUrlString = service.apiBaseUrlString;

DOUHttpRequest *req = [DOUHttpRequest requestWithQuery:query target:self];

DOUService *service = [DOUService sharedInstance];
[service addRequest:req];
</code></pre>

<h3>使用v0.1.1之后的版本</h3>

<p>通过apiKey等获得一个engine。</p>

<pre><code>DOUEngine *engine = [[DOUEngine alloc] initWithApiKey:kAPIKey
                                        withSecretKey:kPrivateKey
                                         withRedirUrl:kRedirectUrl];
</code></pre>

<p>通过engine获得event_engine。</p>

<pre><code>DOUEventEngine *event_engine = [self.engine getEngine:kDOUEvent];
</code></pre>

<p>使用闭包进行网络请求。</p>

<pre><code>void(^successBlock)(DOUEvent *) = ^(DOUEvent *event) {
    [self updateImageUI:event];
};
</code></pre>

<p>使用engine内封装好的方法，把闭包传进去。</p>

<pre><code>[event_engine getEventWithRemoteID:self.eid_field.title successBlock:successBlock];
</code></pre>

<p>具体还是请看Sample代码，简单易懂。</p>

<h2>示例</h2>

<p>Sample是一个简单的客户端，用来演示各种功能。</p>

<p>可以在菜单栏里打开相应的Sample，Sample并不是同步更新完善。但基本上重要的接口都会有示例。</p>

<p>示例有：</p>

<ol>
<li>豆瓣读书</li>
<li>豆瓣电影</li>
<li>豆瓣音乐</li>
<li>豆瓣同城</li>
<li>豆瓣社区</li>
<li>豆瓣用户</li>
<li>豆瓣相册</li>
<li>豆瓣评论</li>
<li>豆瓣回复</li>
<li>豆瓣广播</li>
<li>豆瓣日记</li>
<li>豆瓣豆邮</li>
<li>线上活动</li>
</ol>

<h2>历史</h2>

<p>v0.1</p>

<ol>
<li>移植iOS版本支持MacOS并调整结构。</li>
<li>去掉GData等老版本的支持。</li>
</ol>

<p>v0.1.1</p>

<ol>
<li>使用封装的DOUEngine开发api，更加简单。</li>
<li>增加一些常用的model。</li>
</ol>

<p>v0.1.2</p>

<ol>
<li>完善Engine。</li>
</ol>

<p><a href="https://bitdeli.com/free" title="Bitdeli Badge"><img src="https://d2weczhvl823v0.cloudfront.net/GuoJing/doubanapicocoa-osx/trend.png" alt="Bitdeli Badge"></a></p>

</div>

<div class="footer">

© Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://guojing.me/duidui" target="_blank">duidui</a>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</div>
</body>
</html>
